<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Invoice Generator - WeReelit</title>
    <link rel="icon" type="image/png" href="assets/WeReelit Fav Logo.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            dark: '#114238',    
                            darker: '#0d332b',
                            black: '#051411',
                            main: '#1B7F66',    
                            light: '#72CFA6',   
                            text: '#E0FDF4',    
                            white: '#FFFFFF'
                        }
                    },
                    fontFamily: {
                        sans: ['Montserrat', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        /* ----------------------------------------------------
           PRINT STYLES
           ---------------------------------------------------- */
        @page { size: A4; margin: 0; }
        @media print {
            html, body { width: 210mm; height: 297mm; margin: 0 !important; padding: 0 !important; overflow: hidden; }
            body * { visibility: hidden; }
            #invoice-capture, #invoice-capture * { visibility: visible; }
            #print-area { position: absolute; left: 0; top: 0; width: 210mm; height: 297mm; margin: 0; padding: 0; }
            #invoice-capture { 
                transform: scale(1) !important; margin: 0 !important; box-shadow: none !important;
                width: 100% !important; height: 100% !important; border: none !important;
                -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important;
            }
            .no-print, .resizer, #sidebar, #preview-anchor { display: none !important; }
        }

        /* APP STYLES */
        body { background-color: #1a1a1a; }
        
        .form-group { margin-bottom: 0.75rem; }
        .form-label { display: block; font-size: 0.75rem; color: #a3a3a3; margin-bottom: 0.25rem; font-weight: 600; text-transform: uppercase; }
        
        /* INPUT STYLING */
        .form-input { 
            width: 100%; background: #333; border: 1px solid #404040; color: white; padding: 0.7rem; 
            border-radius: 6px; font-size: 0.95rem;
            color-scheme: dark; 
        }
        .form-input:focus { border-color: #72CFA6; outline: none; }

        /* CUSTOM SPINNER FIX (Number Inputs) */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            filter: invert(1); /* Makes arrows white on dark bg */
            cursor: pointer;
            opacity: 0.6;
        }
        input[type="number"]::-webkit-inner-spin-button:hover { opacity: 1; }

        /* Custom Green Calendar Icon */
        ::-webkit-calendar-picker-indicator {
            cursor: pointer;
            filter: invert(0.8) sepia(1) saturate(3) hue-rotate(80deg); 
            opacity: 0.8;
        }
        ::-webkit-calendar-picker-indicator:hover { opacity: 1; }

        select.form-input {
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23a3a3a3' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.75rem center; background-repeat: no-repeat; background-size: 1.2em 1.2em;
        }

        .section-title {
            color: #72CFA6; font-size: 0.8rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em;
            margin-top: 1.5rem; margin-bottom: 0.75rem; border-bottom: 1px solid #404040; padding-bottom: 0.25rem;
        }

        /* PAID STAMP */
        .paid-stamp {
            display: none; position: absolute; top: 40%; left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            color: #16a34a; border: 4px solid #16a34a;
            font-size: 4rem; font-weight: 800; padding: 0.5rem 1rem;
            text-transform: uppercase; opacity: 0.7; z-index: 50;
            pointer-events: none; border-radius: 8px; letter-spacing: 0.1em;
            mix-blend-mode: multiply;
        }

        /* A4 CONTAINER */
        .a4-container {
            width: 210mm; height: 297mm; background: white; position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.5); transform-origin: top center; 
            margin-bottom: 20px; overflow: hidden; 
        }

        /* RESIZER */
        .resizer {
            width: 8px; cursor: col-resize; background-color: #333;
            border-left: 1px solid #444; border-right: 1px solid #222;
            transition: background-color 0.2s; z-index: 30; display: flex;
            align-items: center; justify-content: center;
        }
        .resizer:hover, .resizer.resizing { background-color: #72CFA6; }
        .resizer-icon { width: 4px; height: 30px; border-left: 1px solid #666; border-right: 1px solid #666; }

        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #1a1a1a; }
        ::-webkit-scrollbar-thumb { background: #404040; border-radius: 4px; }
    </style>
</head>
<body class="font-sans text-brand-black">

    <div class="flex flex-col lg:flex-row min-h-screen lg:h-screen lg:overflow-hidden">
        
        <aside id="sidebar" class="w-full lg:w-[450px] bg-[#262626] border-b lg:border-b-0 lg:border-r border-[#333] flex-shrink-0 z-20 h-auto lg:h-full lg:overflow-y-auto relative no-print">
            <div class="p-6 pb-12">
                
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h2 class="text-xl font-bold text-white mb-1">Invoice Generator</h2>
                        <p class="text-xs text-brand-light">WeReelit Pricing & Plans</p>
                    </div>
                </div>

                <a href="#preview-anchor" class="lg:hidden block w-full text-center bg-gray-700 text-brand-light font-bold py-2 rounded mb-6 border border-gray-600">
                    ⬇ Jump to Preview
                </a>

                <div class="form-group">
                    <label class="form-label text-brand-light">Invoice Mode</label>
                    <select id="inp-mode" oninput="updateInvoice()" class="form-input bg-brand-darker border-brand-main font-bold text-brand-light">
                        <option value="final">Final Payment (Balance Due)</option>
                        <option value="advance">Advance Payment (Initial)</option>
                    </select>
                </div>

                <div class="grid grid-cols-2 gap-3 mb-3">
                    <div class="form-group flex items-center gap-2 bg-gray-800 p-2 rounded border border-gray-700">
                        <input type="checkbox" id="inp-paid-status" onchange="updateInvoice()" class="w-4 h-4 accent-brand-main cursor-pointer">
                        <label for="inp-paid-status" class="text-white text-xs font-bold cursor-pointer select-none">Mark PAID</label>
                    </div>
                    <div class="form-group flex items-center gap-2 bg-gray-800 p-2 rounded border border-gray-700">
                        <input type="checkbox" id="inp-custom-toggle" onchange="toggleCustomField()" class="w-4 h-4 accent-brand-main cursor-pointer">
                        <label for="inp-custom-toggle" class="text-white text-xs font-bold cursor-pointer select-none">Add Note</label>
                    </div>
                </div>

                <div id="custom-design-box" class="form-group hidden">
                    <label class="form-label text-brand-light">Custom Design Details / Note</label>
                    <textarea id="inp-custom-note" rows="2" class="form-input" placeholder="Enter custom details here..." oninput="updateInvoice()"></textarea>
                </div>

                <div class="grid grid-cols-2 gap-3 mt-4">
                    <div class="form-group">
                        <label class="form-label">Invoice #</label>
                        <input type="text" id="inp-no" class="form-input" value="001" oninput="updateInvoice()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Date</label>
                        <input type="date" id="inp-date" class="form-input" oninput="updateInvoice()">
                    </div>
                </div>

                <div class="section-title">Client Details</div>
                <div class="form-group">
                    <label class="form-label">Client Name</label>
                    <input type="text" id="inp-client-name" class="form-input" placeholder="[Client Name]" oninput="updateInvoice()">
                </div>
                <div class="form-group">
                    <label class="form-label">Company</label>
                    <input type="text" id="inp-client-co" class="form-input" placeholder="[Client Company]" oninput="updateInvoice()">
                </div>
                <div class="form-group">
                    <label class="form-label">Contact</label>
                    <input type="text" id="inp-client-contact" class="form-input" placeholder="[Client Email/Phone]" oninput="updateInvoice()">
                </div>

                <div class="section-title">Project Details</div>
                <div class="form-group">
                    <label class="form-label">Video Style</label>
                    <select id="inp-style" oninput="updateInvoice()" class="form-input">
                        <option value="VoiceSync (Lip-Sync Dubbing)">VoiceSync (Lip-Sync Dubbing)</option>
                        <option value="Podcast (Conversations & Clips)">Podcast (Conversations & Clips)</option>
                        <option value="Informative (Knowledge Simplified)">Informative (Knowledge Simplified)</option>
                        <option value="Animated (Motion Graphics)">Animated (Motion Graphics)</option>
                        <option value="Story (Cinematic Visuals)">Story (Cinematic Visuals)</option>
                        <option value="Custom Project">Custom Project</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Project Name</label>
                    <input type="text" id="inp-project" class="form-input" value="Social Media Content" oninput="updateInvoice()">
                </div>
                
                <div class="form-group">
                    <label class="form-label text-brand-light">Select Package (Auto-Fills)</label>
                    <select id="inp-package" onchange="applyPackageDefaults()" class="form-input font-bold">
                        <option value="Custom">Custom</option>
                        <option value="Basic">Basic (₹800/video | 20-30 Sec)</option>
                        <option value="Simple">Simple (₹1000/video | 30-40 Sec)</option>
                        <option value="Intermediate" selected>Intermediate (₹1200/video | 40-50 Sec)</option>
                        <option value="Advance">Advance (₹1500/video | 50s-1 Min)</option>
                    </select>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <div class="form-group">
                        <label class="form-label">Duration</label>
                        <input type="text" id="inp-duration" class="form-input" value="40 - 50 Sec" oninput="updateInvoice()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Video Count</label>
                        <input type="number" id="inp-vid-count" class="form-input" value="1" oninput="applyPackageDefaults()">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <div class="form-group">
                        <label class="form-label">Revisions</label>
                        <select id="inp-revisions" oninput="updateInvoice()" class="form-input">
                            <option value="1 Correction">1 Correction</option>
                            <option value="2 Corrections">2 Corrections</option>
                            <option value="3 Corrections">3 Corrections</option>
                            <option value="4 Corrections">4 Corrections</option>
                            <option value="Unlimited Revisions">Unlimited Revisions</option>
                            <option value="None">None</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Rush / Add-on</label>
                        <select id="inp-addon-select" onchange="toggleCustomAddon()" class="form-input">
                            <option value="N/A" selected>N/A</option>
                            <option value="24hr Rush Delivery">24hr Rush Delivery</option>
                            <option value="Source Files Included">Source Files Included</option>
                            <option value="Subtitles / Captions">Subtitles / Captions</option>
                            <option value="Thumbnail Design">Thumbnail Design</option>
                            <option value="custom">Write Custom...</option>
                        </select>
                        <input type="text" id="inp-addon-custom" class="form-input mt-2 hidden" placeholder="Type add-on details..." oninput="updateInvoice()">
                    </div>
                </div>

                <div class="section-title">Financials</div>
                
                <div class="grid grid-cols-2 gap-3">
                    <div class="form-group">
                        <label class="form-label">Base Price (₹) (Auto-Calc)</label>
                        <input type="number" id="inp-base-price" class="form-input font-bold" value="1200" oninput="updateInvoice()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Advance % (on Base)</label>
                        <input type="number" id="inp-adv-percent" class="form-input" value="30" oninput="updateInvoice()">
                    </div>
                </div>

                <div class="bg-gray-800 p-3 rounded border border-gray-700 mt-2">
                    <label class="form-label text-brand-light mb-2">Additional Costs (Optional)</label>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="form-group mb-0">
                            <input type="text" id="inp-extra-desc" class="form-input" placeholder="e.g. Rush Fee" oninput="updateInvoice()">
                        </div>
                        <div class="form-group mb-0">
                            <input type="number" id="inp-extra-amount" class="form-input" placeholder="Amount" oninput="updateInvoice()">
                        </div>
                    </div>
                </div>

                <div class="mt-4 pt-4 border-t border-gray-700">
                    <div class="flex justify-between items-center">
                        <span class="text-sm font-bold text-white">Grand Total:</span>
                        <span id="sidebar-total-display" class="text-lg font-bold text-brand-light">₹1200</span>
                    </div>
                </div>

                <div class="section-title">Payment Info</div>
                
                <div class="space-y-4">
                    
                    <div class="form-group bg-[#2a2a2a] p-3 rounded border border-[#444]">
                        <label class="form-label text-brand-light mb-2">UPI DETAILS</label>
                        
                        <div class="flex items-center gap-2 mb-2">
                            <input type="checkbox" id="inp-show-name" checked onchange="updateInvoice()" class="w-4 h-4 accent-brand-main cursor-pointer flex-shrink-0">
                            <div class="flex-grow">
                                <label class="text-[10px] text-gray-400 uppercase font-bold block mb-1">Account Name</label>
                                <input type="text" id="inp-upi-name" class="form-input py-1 text-sm" value="M SUBHAM" oninput="updateInvoice()">
                            </div>
                        </div>

                        <div class="flex items-center gap-2">
                            <input type="checkbox" id="inp-show-id" checked onchange="updateInvoice()" class="w-4 h-4 accent-brand-main cursor-pointer flex-shrink-0">
                            <div class="flex-grow">
                                <label class="text-[10px] text-gray-400 uppercase font-bold block mb-1">UPI ID</label>
                                <input type="text" id="inp-upi-id" class="form-input py-1 text-sm" placeholder="user@bank" oninput="updateInvoice()">
                            </div>
                        </div>
                    </div>

                    <div class="form-group bg-[#2a2a2a] p-3 rounded border border-[#444]">
                        <div class="flex items-center justify-between mb-2">
                            <label class="form-label text-brand-light mb-0">GPAY / PHONEPE</label>
                            <input type="checkbox" id="inp-show-phone" checked onchange="updateInvoice()" class="w-4 h-4 accent-brand-main cursor-pointer">
                        </div>
                        <input type="text" id="inp-payto-phone" class="form-input" placeholder="+91 00000 00000" oninput="updateInvoice()">
                    </div>

                </div>

                <div class="mt-8 flex flex-col gap-3">
                    <button onclick="downloadAsImage()" class="w-full bg-brand-main text-white py-4 rounded-lg font-bold hover:bg-brand-light hover:text-brand-dark transition-colors flex items-center justify-center gap-2 shadow-lg">
                        <i class="fas fa-image"></i> Save as Image
                    </button>
                    <button onclick="saveAsPDF()" class="w-full bg-gray-700 text-white py-4 rounded-lg font-bold hover:bg-gray-600 transition-colors flex items-center justify-center gap-2 shadow-lg">
                        <i class="fas fa-file-pdf"></i> Save as PDF
                    </button>
                </div>
            </div>
        </aside>

        <div id="dragMe" class="resizer hidden lg:flex no-print">
            <div class="resizer-icon"></div>
        </div>

        <main id="preview-container" class="flex-grow bg-[#525252] overflow-visible lg:overflow-y-auto overflow-x-hidden flex justify-center p-4 lg:p-8 h-auto lg:h-full">
            <div id="print-area">
                <div id="preview-anchor" class="h-2 lg:hidden"></div>

                <div id="invoice-capture" class="a4-container">
                    
                    <div id="stamp-paid" class="paid-stamp">PAID</div>

                    <div class="px-8 pt-10 h-full relative">
                        
                        <div class="flex justify-between items-start border-b-2 border-brand-dark pb-4 mb-6">
                            <div>
                                <h1 class="text-4xl font-bold text-brand-dark tracking-tighter">We<span class="text-brand-light">Reelit</span></h1>
                                <p class="text-xs text-brand-main font-semibold tracking-wide mt-1">Professional Video Editing & Services</p>
                            </div>
                            <div class="text-right">
                                <h2 class="text-2xl font-bold text-gray-400 uppercase tracking-widest" id="out-header-type">INVOICE</h2>
                                <div class="text-sm text-brand-darker mt-1 flex flex-col items-end gap-1">
                                    <div class="flex items-center gap-2">
                                        <span class="font-bold text-brand-dark">Date:</span> 
                                        <span id="out-date" class="min-w-[80px] text-right"></span>
                                    </div>
                                    <div>
                                        <span class="font-bold text-brand-dark">Invoice #:</span> 
                                        <span id="out-no"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="flex justify-between mb-8">
                            <div class="w-1/2 pr-4">
                                <h3 class="text-[11px] font-bold text-brand-main uppercase tracking-widest mb-2">Bill To</h3>
                                <div class="text-brand-black text-sm leading-relaxed font-medium">
                                    <span id="out-client-name" class="block font-bold"></span>
                                    <span id="out-client-co" class="block"></span>
                                    <span id="out-client-contact" class="block text-gray-600"></span>
                                </div>
                            </div>
                            <div class="w-1/2 text-right pl-4">
                                <h3 class="text-[11px] font-bold text-brand-main uppercase tracking-widest mb-2">Pay To</h3>
                                <p class="text-brand-black text-sm leading-relaxed font-medium">
                                    <span class="font-bold text-brand-dark">WeReelit</span><br>
                                    <span>+91 79089 13742</span><br>
                                    Freelance Video Editor
                                </p>
                            </div>
                        </div>

                        <table class="w-full mb-6">
                            <thead>
                                <tr class="bg-brand-dark text-brand-text text-left text-[11px] uppercase tracking-wider">
                                    <th class="py-3 px-5 w-3/4 font-semibold">Description</th>
                                    <th class="py-3 px-5 text-right w-1/4 font-semibold">Amount (INR)</th>
                                </tr>
                            </thead>
                            <tbody class="text-brand-black text-sm">
                                <tr class="border-b border-gray-100">
                                    <td class="py-5 px-5 align-top">
                                        <span id="out-style" class="font-bold text-brand-darker block text-base mb-3"></span>
                                        <div class="text-gray-600 text-xs space-y-2">
                                            <div class="flex gap-2">
                                                <span class="font-bold w-24 flex-shrink-0">Project:</span>
                                                <span id="out-project"></span>
                                            </div>
                                            <div class="flex gap-2">
                                                <span class="font-bold w-24 flex-shrink-0">Package:</span>
                                                <span id="out-package"></span>
                                            </div>
                                            <div class="flex gap-2">
                                                <span class="font-bold w-24 flex-shrink-0">Duration:</span>
                                                <span id="out-duration"></span>
                                            </div>
                                            <div class="flex gap-2">
                                                <span class="font-bold w-24 flex-shrink-0">Video Count:</span>
                                                <span id="out-vid-count"></span>
                                            </div>
                                            <div class="flex gap-2">
                                                <span class="font-bold w-24 flex-shrink-0">Revisions:</span>
                                                <span id="out-revisions"></span>
                                            </div>
                                            <div class="flex gap-2">
                                                <span class="font-bold w-24 flex-shrink-0">Rush/Add-on:</span>
                                                <span id="out-addon"></span>
                                            </div>
                                            <div id="out-custom-note-row" class="hidden mt-3 pt-2 border-t border-dashed border-gray-200">
                                                <span class="font-bold w-full block mb-1 text-brand-main">Note:</span>
                                                <span id="out-custom-note-text" class="italic text-gray-500"></span>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="py-5 px-5 text-right font-bold align-top text-brand-dark text-base">
                                        <span id="out-base-price"></span>
                                    </td>
                                </tr>
                                <tr id="row-extra-cost" class="border-b border-gray-100 hidden">
                                    <td class="py-4 px-5 align-top">
                                        <span id="out-extra-desc" class="font-bold text-brand-darker block text-sm"></span>
                                        <span class="text-xs text-gray-500 italic">Additional Charge</span>
                                    </td>
                                    <td class="py-4 px-5 text-right font-bold align-top text-brand-dark text-sm">
                                        <span id="out-extra-amount"></span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="flex justify-end">
                            <div class="w-1/2">
                                <div class="flex justify-between py-2 px-5 border-b border-gray-100 text-sm">
                                    <span class="text-gray-600">Total Amount</span>
                                    <span id="out-total-amount" class="font-bold text-brand-black"></span>
                                </div>
                                <div id="row-advance-deduction" class="flex justify-between py-2 px-5 border-b border-gray-100 bg-green-50 text-sm">
                                    <span class="text-brand-main font-medium" id="lbl-advance-desc">Less: Advance (30%)</span>
                                    <span id="out-advance-amt" class="font-bold text-brand-main"></span>
                                </div>
                                <div class="flex justify-between py-3 px-5 bg-brand-dark text-brand-text mt-2 rounded-sm shadow-sm">
                                    <span class="font-bold uppercase text-sm self-center" id="lbl-total-due">Balance Due</span>
                                    <span class="font-bold text-lg" id="out-grand-total"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="footer-section absolute bottom-0 w-full px-8 pb-10 pt-5 border-t border-gray-200 bg-brand-white">
                        <div class="grid grid-cols-2 gap-10">
                            <div>
                                <h3 class="text-sm font-bold text-brand-dark mb-3 uppercase tracking-wider">Payment Details</h3>
                                
                                <p id="row-upi-name" class="text-sm text-brand-darker mb-2">
                                    <strong class="mr-1 text-brand-black">UPI Holder:</strong> <span id="out-upi-name" class="font-medium"></span>
                                </p>
                                
                                <p id="row-upi-id" class="text-sm text-brand-darker mb-2">
                                    <strong class="mr-1 text-brand-black">UPI ID:</strong> <span id="out-upi-id" class="font-medium"></span>
                                </p>
                                
                                <p id="row-phone" class="text-sm text-brand-darker">
                                    <strong class="mr-1 text-brand-black">GPay/PhonePe:</strong> <span id="out-footer-phone"></span>
                                </p>
                            </div>
                            <div>
                                <h3 class="text-sm font-bold text-brand-dark mb-3 uppercase tracking-wider">Terms & Conditions</h3>
                                <div class="text-[13px] text-gray-600 leading-snug space-y-1 mt-1">
                                    <div class="flex items-start">
                                        <span class="mr-2 text-brand-light font-bold">•</span>
                                        <span id="term-1">Secure Payment: 30% advance required to begin.</span>
                                    </div>
                                    <div class="flex items-start">
                                        <span class="mr-2 text-brand-light font-bold">•</span>
                                        <span>Rapid Turnaround: First draft within 24-48 hours.</span>
                                    </div>
                                    <div class="flex items-start">
                                        <span class="mr-2 text-brand-light font-bold">•</span>
                                        <span>Final Delivery: Watermark removed on full payment.</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // SIDEBAR RESIZER
        document.addEventListener('DOMContentLoaded', function() {
            const resizer = document.getElementById('dragMe');
            const leftSide = document.getElementById('sidebar');
            let x = 0; let leftWidth = 0;
            const mouseDownHandler = function(e) {
                x = e.clientX;
                leftWidth = leftSide.getBoundingClientRect().width;
                resizer.classList.add('resizing');
                document.body.style.cursor = 'col-resize';
                document.addEventListener('mousemove', mouseMoveHandler);
                document.addEventListener('mouseup', mouseUpHandler);
            };
            const mouseMoveHandler = function(e) {
                const dx = e.clientX - x;
                const newWidth = leftWidth + dx;
                if (newWidth > 300 && newWidth < Math.min(800, window.innerWidth * 0.7)) {
                    leftSide.style.width = `${newWidth}px`;
                    adjustPreviewScale();
                }
            };
            const mouseUpHandler = function() {
                resizer.classList.remove('resizing');
                document.body.style.removeProperty('cursor');
                document.removeEventListener('mousemove', mouseMoveHandler);
                document.removeEventListener('mouseup', mouseUpHandler);
            };
            resizer.addEventListener('mousedown', mouseDownHandler);
        });

        // SCALING
        function adjustPreviewScale() {
            const previewContainer = document.getElementById('preview-container');
            const invoice = document.getElementById('invoice-capture');
            const containerWidth = previewContainer.clientWidth;
            const a4Width = 794; 
            const padding = 32; 
            if (containerWidth < (a4Width + padding)) {
                const scale = (containerWidth - padding) / a4Width;
                invoice.style.transform = `scale(${scale})`;
                const heightReduction = (1 - scale) * 1123;
                invoice.style.marginBottom = `-${heightReduction}px`;
            } else {
                invoice.style.transform = 'scale(1)';
                invoice.style.marginBottom = '20px';
            }
        }
        window.addEventListener('load', adjustPreviewScale);
        window.addEventListener('resize', adjustPreviewScale);

        // INVOICE LOGIC
        const packages = {
            "Basic": { price: 800, duration: "20 - 30 Sec", revisions: "1 Correction" },
            "Simple": { price: 1000, duration: "30 - 40 Sec", revisions: "2 Corrections" },
            "Intermediate": { price: 1200, duration: "40 - 50 Sec", revisions: "3 Corrections" },
            "Advance": { price: 1500, duration: "50s - 1 Min", revisions: "4 Corrections" },
            "Custom": { price: 0, duration: "", revisions: "None" }
        };
        const formatINR = (number) => new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', minimumFractionDigits: 0 }).format(number);

        document.getElementById('inp-date').valueAsDate = new Date();

        function toggleCustomAddon() {
            const select = document.getElementById('inp-addon-select');
            const customInput = document.getElementById('inp-addon-custom');
            if(select.value === 'custom') {
                customInput.classList.remove('hidden');
                customInput.focus();
            } else {
                customInput.classList.add('hidden');
            }
            updateInvoice();
        }

        // TOGGLE CUSTOM NOTE
        function toggleCustomField() {
            const chk = document.getElementById('inp-custom-toggle');
            const box = document.getElementById('custom-design-box');
            if(chk.checked) {
                box.classList.remove('hidden');
            } else {
                box.classList.add('hidden');
                document.getElementById('inp-custom-note').value = ""; // Clear on hide
            }
            updateInvoice();
        }

        function applyPackageDefaults() {
            const pkg = document.getElementById('inp-package').value;
            const count = parseFloat(document.getElementById('inp-vid-count').value) || 1;
            if (packages[pkg] && pkg !== 'Custom') {
                const unitPrice = packages[pkg].price;
                const totalPrice = unitPrice * count; 
                document.getElementById('inp-base-price').value = totalPrice;
                document.getElementById('inp-duration').value = packages[pkg].duration;
                document.getElementById('inp-revisions').value = packages[pkg].revisions;
            } 
            updateInvoice();
        }

        function updateInvoice() {
            const mode = document.getElementById('inp-mode').value;
            const paidStatus = document.getElementById('inp-paid-status').checked;
            
            // Client
            const clientName = document.getElementById('inp-client-name').value;
            const clientCo = document.getElementById('inp-client-co').value;
            const clientContact = document.getElementById('inp-client-contact').value;

            // Project
            const style = document.getElementById('inp-style').value;
            const project = document.getElementById('inp-project').value;
            const pkgTxt = document.getElementById('inp-package').value;
            const duration = document.getElementById('inp-duration').value;
            const vidCount = document.getElementById('inp-vid-count').value;
            const revisions = document.getElementById('inp-revisions').value;
            
            const addonSelect = document.getElementById('inp-addon-select').value;
            const addonCustom = document.getElementById('inp-addon-custom').value;
            const finalAddon = (addonSelect === 'custom') ? (addonCustom || 'Custom') : addonSelect;

            // Payment Inputs
            const showName = document.getElementById('inp-show-name').checked;
            const upiName = document.getElementById('inp-upi-name').value;
            
            const showID = document.getElementById('inp-show-id').checked;
            const upiVal = document.getElementById('inp-upi-id').value;
            
            const showPhone = document.getElementById('inp-show-phone').checked;
            const phoneVal = document.getElementById('inp-payto-phone').value;

            // Financials
            const basePrice = parseFloat(document.getElementById('inp-base-price').value) || 0;
            const extraAmount = parseFloat(document.getElementById('inp-extra-amount').value) || 0;
            const extraDesc = document.getElementById('inp-extra-desc').value || "Additional Cost";
            const advPercent = parseFloat(document.getElementById('inp-adv-percent').value) || 0;

            const totalAmount = basePrice + extraAmount;
            const advanceAmt = Math.round(basePrice * (advPercent / 100));
            const balanceAmt = totalAmount - advanceAmt;

            // Custom Note
            const customNoteText = document.getElementById('inp-custom-note').value;
            const customNoteToggle = document.getElementById('inp-custom-toggle').checked;

            // Render
            document.getElementById('out-no').innerText = document.getElementById('inp-no').value;
            const d = new Date(document.getElementById('inp-date').value);
            document.getElementById('out-date').innerText = d.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });

            const elName = document.getElementById('out-client-name');
            const elCo = document.getElementById('out-client-co');
            const elContact = document.getElementById('out-client-contact');
            elName.innerText = clientName || "[Client Name]";
            elName.className = clientName ? "block font-bold" : "block font-bold text-gray-400 italic";
            elCo.innerText = clientCo || "[Client Company]";
            elCo.className = clientCo ? "block" : "block text-gray-400 italic";
            elContact.innerText = clientContact || "[Client Email/Phone]";
            elContact.className = clientContact ? "block text-gray-600" : "block text-gray-400 italic";

            document.getElementById('out-style').innerText = style;
            document.getElementById('out-project').innerText = project;
            document.getElementById('out-package').innerText = pkgTxt === 'Custom' ? 'Custom Package' : pkgTxt + ' Package';
            document.getElementById('out-duration').innerText = duration;
            document.getElementById('out-vid-count').innerText = vidCount;
            document.getElementById('out-revisions').innerText = revisions;
            document.getElementById('out-addon').innerText = finalAddon;

            // Custom Note Render
            const noteRow = document.getElementById('out-custom-note-row');
            if(customNoteToggle && customNoteText.trim() !== "") {
                noteRow.classList.remove('hidden');
                document.getElementById('out-custom-note-text').innerText = customNoteText;
            } else {
                noteRow.classList.add('hidden');
            }

            // --- PAYMENT LOGIC ---
            // Name Line
            const rowName = document.getElementById('row-upi-name');
            if (showName) {
                rowName.style.display = 'block';
                document.getElementById('out-upi-name').innerText = upiName;
            } else {
                rowName.style.display = 'none';
            }

            // ID Line
            const rowID = document.getElementById('row-upi-id');
            if (showID) {
                rowID.style.display = 'block';
                document.getElementById('out-upi-id').innerText = upiVal;
            } else {
                rowID.style.display = 'none';
            }

            // Phone Line
            const rowPhone = document.getElementById('row-phone');
            if (showPhone) {
                rowPhone.style.display = 'block';
                document.getElementById('out-footer-phone').innerText = phoneVal;
            } else {
                rowPhone.style.display = 'none';
            }

            document.getElementById('out-base-price').innerText = formatINR(basePrice);
            
            const extraRow = document.getElementById('row-extra-cost');
            if (extraAmount > 0) {
                extraRow.classList.remove('hidden');
                document.getElementById('out-extra-desc').innerText = extraDesc;
                document.getElementById('out-extra-amount').innerText = formatINR(extraAmount);
            } else {
                extraRow.classList.add('hidden');
            }

            document.getElementById('out-total-amount').innerText = formatINR(totalAmount);
            document.getElementById('sidebar-total-display').innerText = formatINR(totalAmount); 

            const advRow = document.getElementById('row-advance-deduction');
            const headerType = document.getElementById('out-header-type');
            const totalDueLabel = document.getElementById('lbl-total-due');
            const term1 = document.getElementById('term-1');

            if (mode === 'advance') {
                headerType.innerText = "ADVANCE INVOICE";
                advRow.style.display = 'none';
                totalDueLabel.innerText = `Advance Due (${advPercent}%)`;
                document.getElementById('out-grand-total').innerText = formatINR(advanceAmt);
                term1.innerHTML = `<strong>Secure Payment:</strong> This ${advPercent}% advance is required to begin.`;
            } else {
                headerType.innerText = "INVOICE";
                advRow.style.display = 'flex';
                document.getElementById('lbl-advance-desc').innerText = `Less: Advance (${advPercent}%)`;
                document.getElementById('out-advance-amt').innerText = "- " + formatINR(advanceAmt);
                totalDueLabel.innerText = "Balance Due";
                document.getElementById('out-grand-total').innerText = formatINR(balanceAmt);
                term1.innerHTML = `<strong>Secure Payment:</strong> ${advPercent}% advance required to begin.`;
            }

            const stamp = document.getElementById('stamp-paid');
            stamp.style.display = paidStatus ? 'block' : 'none';
        }

        updateInvoice();
        adjustPreviewScale(); 

        // FILES
        function getInvoiceFilename() {
            const invoiceNo = document.getElementById('inp-no').value || '000';
            const client = document.getElementById('inp-client-name').value || 'Client';
            const mode = document.getElementById('inp-mode').value === 'advance' ? 'Advance' : 'Final';
            const cleanClient = client.replace(/[^a-zA-Z0-9]/g, '_');
            const cleanNo = invoiceNo.replace(/[^a-zA-Z0-9]/g, '-');
            return `WeReelit_Invoice_${cleanNo}_${cleanClient}_${mode}`;
        }

        function saveAsPDF() {
            const originalTitle = document.title;
            document.title = getInvoiceFilename();
            window.print();
            setTimeout(() => { document.title = originalTitle; }, 100);
        }

        function downloadAsImage() {
            const element = document.getElementById('invoice-capture');
            const filename = getInvoiceFilename() + ".png";
            const originalTransform = element.style.transform;
            const originalMargin = element.style.margin;
            element.style.transform = 'scale(1)';
            element.style.boxShadow = 'none';
            html2canvas(element, {
                scale: 2, useCORS: true, backgroundColor: "#ffffff",
                width: 794, height: 1123, windowWidth: 794, windowHeight: 1123
            }).then(canvas => {
                element.style.transform = originalTransform;
                element.style.boxShadow = '0 0 20px rgba(0,0,0,0.5)';
                const link = document.createElement('a');
                link.download = filename;
                link.href = canvas.toDataURL("image/png");
                link.click();
            });
        }
    </script>
</body>
</html>
